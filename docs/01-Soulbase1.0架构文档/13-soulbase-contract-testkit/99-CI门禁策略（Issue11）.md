# CI 门禁策略（Issue 11 对齐）

> 为契约测试工具定义标签化与跳过策略，保证 PR 快速可用、Nightly 全量回归，且失败可定位到契约断言。

## 标签化与选择

- 用例标签：`core`（主路径）、`neg-high`（高价值负向）、`slow`（长耗时）、`cross-domain`（跨域链路）、`perf`（性能基准）。
- PR 选择：`--tags=core,neg-high`；Nightly 选择：`--tags=*` 或补充 `perf,cross-domain,slow`。
- 跳过机制：`@skip(ci)`；允许通过环境变量解除跳过。

## 输出与断言

- 失败输出包含：契约 ID、断言名、期望 vs 实际、涉及的公共视图/标签摘要；
- 统一错误码检查：断言 SB‑02 公共视图与映射；
- 支持 JSON 输出供 CI 采集；

## 稳定性与去抖

- 固定 seed，必要时多次取中位数；
- flaky 用例隔离 `@quarantine` 并在 Nightly 关注；
- 幂等相关用例限制重试预算，避免放大；

## 验收

- PR 时间达标；
- 失败日志可精确定位契约断言；
- 标签选择与跳过策略有效；
- 覆盖率不下降（关键契约）；
